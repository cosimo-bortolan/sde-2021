var DragDropTouch;
(function(h){var k=function(){function b(){this._dropEffect="move";this._effectAllowed="all";this._data={}}Object.defineProperty(b.prototype,"dropEffect",{get:function(){return this._dropEffect},set:function(a){this._dropEffect=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"effectAllowed",{get:function(){return this._effectAllowed},set:function(a){this._effectAllowed=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"types",{get:function(){return Object.keys(this._data)},enumerable:!0,
configurable:!0});b.prototype.clearData=function(a){null!=a?delete this._data[a]:this._data=null};b.prototype.getData=function(a){return this._data[a]||""};b.prototype.setData=function(a,c){this._data[a]=c};b.prototype.setDragImage=function(a,c,b){var d=e._instance;d._imgCustom=a;d._imgOffset={x:c,y:b}};return b}();h.DataTransfer=k;var e=function(){function b(){this._lastClick=0;if(b._instance)throw"DragDropTouch instance already created.";var a=!1;document.addEventListener("test",function(){},{get passive(){return a=
!0}});if("ontouchstart"in document){var c=document,f=this._touchstart.bind(this),d=this._touchmove.bind(this),e=this._touchend.bind(this),l=a?{passive:!1,capture:!1}:!1;c.addEventListener("touchstart",f,l);c.addEventListener("touchmove",d,l);c.addEventListener("touchend",e);c.addEventListener("touchcancel",e)}}b.getInstance=function(){return b._instance};b.prototype._touchstart=function(a){var c=this;if(this._shouldHandle(a))if(Date.now()-this._lastClick<b._DBLCLICK&&this._dispatchEvent(a,"dblclick",
a.target))a.preventDefault(),this._reset();else{this._reset();var f=this._closestDraggable(a.target);!f||this._dispatchEvent(a,"mousemove",a.target)||this._dispatchEvent(a,"mousedown",a.target)||(this._dragSource=f,this._ptDown=this._getPoint(a),this._lastTouch=a,a.preventDefault(),setTimeout(function(){c._dragSource==f&&null==c._img&&c._dispatchEvent(a,"contextmenu",f)&&c._reset()},b._CTXMENU),b._ISPRESSHOLDMODE&&(this._pressHoldInterval=setTimeout(function(){c._isDragEnabled=!0;c._touchmove(a)},
b._PRESSHOLDAWAIT)))}};b.prototype._touchmove=function(a){if(this._shouldCancelPressHoldMove(a))this._reset();else if(this._shouldHandleMove(a)||this._shouldHandlePressHoldMove(a)){var b=this._getTarget(a);this._dispatchEvent(a,"mousemove",b)?(this._lastTouch=a,a.preventDefault()):(this._dragSource&&!this._img&&this._shouldStartDragging(a)&&(this._dispatchEvent(a,"dragstart",this._dragSource),this._createImage(a),this._dispatchEvent(a,"dragenter",b)),this._img&&(this._lastTouch=a,a.preventDefault(),
b!=this._lastTarget&&(this._dispatchEvent(this._lastTouch,"dragleave",this._lastTarget),this._dispatchEvent(a,"dragenter",b),this._lastTarget=b),this._moveImage(a),this._isDropZone=this._dispatchEvent(a,"dragover",b)))}};b.prototype._touchend=function(a){this._shouldHandle(a)&&(this._dispatchEvent(this._lastTouch,"mouseup",a.target)?a.preventDefault():(this._img||(this._dragSource=null,this._dispatchEvent(this._lastTouch,"click",a.target),this._lastClick=Date.now()),this._destroyImage(),this._dragSource&&
(0>a.type.indexOf("cancel")&&this._isDropZone&&this._dispatchEvent(this._lastTouch,"drop",this._lastTarget),this._dispatchEvent(this._lastTouch,"dragend",this._dragSource),this._reset())))};b.prototype._shouldHandle=function(a){return a&&!a.defaultPrevented&&a.touches&&2>a.touches.length};b.prototype._shouldHandleMove=function(a){return!b._ISPRESSHOLDMODE&&this._shouldHandle(a)};b.prototype._shouldHandlePressHoldMove=function(a){return b._ISPRESSHOLDMODE&&this._isDragEnabled&&a&&a.touches&&a.touches.length};
b.prototype._shouldCancelPressHoldMove=function(a){return b._ISPRESSHOLDMODE&&!this._isDragEnabled&&this._getDelta(a)>b._PRESSHOLDMARGIN};b.prototype._shouldStartDragging=function(a){a=this._getDelta(a);return a>b._THRESHOLD||b._ISPRESSHOLDMODE&&a>=b._PRESSHOLDTHRESHOLD};b.prototype._reset=function(){this._destroyImage();this._ptDown=this._lastTarget=this._lastTouch=this._dragSource=null;this._isDropZone=this._isDragEnabled=!1;this._dataTransfer=new k;clearInterval(this._pressHoldInterval)};b.prototype._getPoint=
function(a,b){a&&a.touches&&(a=a.touches[0]);return{x:b?a.pageX:a.clientX,y:b?a.pageY:a.clientY}};b.prototype._getDelta=function(a){if(b._ISPRESSHOLDMODE&&!this._ptDown)return 0;a=this._getPoint(a);return Math.abs(a.x-this._ptDown.x)+Math.abs(a.y-this._ptDown.y)};b.prototype._getTarget=function(a){a=this._getPoint(a);for(a=document.elementFromPoint(a.x,a.y);a&&"none"==getComputedStyle(a).pointerEvents;)a=a.parentElement;return a};b.prototype._createImage=function(a){this._img&&this._destroyImage();
var c=this._imgCustom||this._dragSource;this._img=c.cloneNode(!0);this._copyStyle(c,this._img);this._img.style.top=this._img.style.left="-9999px";if(!this._imgCustom){c=c.getBoundingClientRect();var f=this._getPoint(a);this._imgOffset={x:f.x-c.left,y:f.y-c.top};this._img.style.opacity=b._OPACITY.toString()}this._moveImage(a);document.body.appendChild(this._img)};b.prototype._destroyImage=function(){this._img&&this._img.parentElement&&this._img.parentElement.removeChild(this._img);this._imgCustom=
this._img=null};b.prototype._moveImage=function(a){var b=this;requestAnimationFrame(function(){if(b._img){var c=b._getPoint(a,!0),d=b._img.style;d.position="absolute";d.pointerEvents="none";d.zIndex="999999";d.left=Math.round(c.x-b._imgOffset.x)+"px";d.top=Math.round(c.y-b._imgOffset.y)+"px"}})};b.prototype._copyProps=function(a,b,f){for(var c=0;c<f.length;c++){var e=f[c];a[e]=b[e]}};b.prototype._copyStyle=function(a,c){b._rmvAtts.forEach(function(a){c.removeAttribute(a)});a instanceof HTMLCanvasElement&&
(c.width=a.width,c.height=a.height,c.getContext("2d").drawImage(a,0,0));for(var e=getComputedStyle(a),d=0;d<e.length;d++){var g=e[d];0>g.indexOf("transition")&&(c.style[g]=e[g])}c.style.pointerEvents="none";for(d=0;d<a.children.length;d++)this._copyStyle(a.children[d],c.children[d])};b.prototype._dispatchEvent=function(a,c,e){if(a&&e){var d=document.createEvent("Event"),f=a.touches?a.touches[0]:a;d.initEvent(c,!0,!0);d.button=0;d.which=d.buttons=1;this._copyProps(d,a,b._kbdProps);this._copyProps(d,
f,b._ptProps);d.dataTransfer=this._dataTransfer;e.dispatchEvent(d);return d.defaultPrevented}return!1};b.prototype._closestDraggable=function(a){for(;a;a=a.parentElement)if(a.hasAttribute("draggable")&&a.draggable)return a;return null};return b}();e._instance=new e;e._THRESHOLD=5;e._OPACITY=.5;e._DBLCLICK=500;e._CTXMENU=900;e._ISPRESSHOLDMODE=!1;e._PRESSHOLDAWAIT=400;e._PRESSHOLDMARGIN=25;e._PRESSHOLDTHRESHOLD=0;e._rmvAtts=["id","class","style","draggable"];e._kbdProps=["altKey","ctrlKey","metaKey",
"shiftKey"];e._ptProps="pageX pageY clientX clientY screenX screenY".split(" ");h.DragDropTouch=e})(DragDropTouch||(DragDropTouch={}));